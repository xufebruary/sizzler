## 空间相关功能列表（components/modules/space/*）

* 空间创建 (space-create)
* 空间邀请 (space-invites)
* 空间成员管理 (space-member)
* 空间设置 (space-settings)




---





### 空间创建（space-create）

**主要功能**

* 空间子域名设置
* 空间名称设置
* 空间成员邀请

**具体细节**

* 功能初始化

  1. 用户判断：新用户 or 老用户
  2. 新用户：表单输入项均为空。
  3. 老用户：获取空间信息，初始化在表单中显示。

* 空间子域名设置

  1. 必输入项

  2. 输入格式校验：长度(2-30)，可以使用数字、字母、破折号(\-)、下划线(\_)、不能以破折号(-)、下划线(\_)、开头和结尾。

     > 正则表达式：
     >
     > ```javascript
     > var reg = /^[a-z0-9][a-z0-9_\-]{0,28}[a-z0-9]$/;
     > ```

  3. 后台重名校验。

     > 接口地址：LINK_SPACE_DOMAIN_CHECK + spaceId + '/' + spaceDomain
     >
     > * 不重名则返回值data.content
     > * 重名则返回空

  4. 校验成功，如果用户还未设置空间名称，则将子域名提取出，设置为空间的默认名称。如果用户已经设置空间名称，则不修改。

  5. 输入框交互：获取焦点触发样式切换(成功 or 错误)，失去焦点触发数据校验，回车事件触发数据校验。

  6. 回车事件触发光标下移至空间名称输入框。

* 空间名称设置

  1. 必输入项
  2. 输入格式校验：长度(1-30)
  3. 输入框交互：获取焦点触发样式切换(成功 or 错误)，失去焦点触发数据校验，回车事件触发数据校验。

* 空间成员邀请

  1. 此步骤可跳过，直接进入产品。
  2. 输入格式校验：输入项需满足邮箱格式，输入的邮箱个数需大于0。

* 数据保存

  1. 创建空间保存

     > 新用户接口地址：LINK_SPACE_ADD
     >
     > 老用户接口地址：LINK_SPACE_UPDATE
     >
     > 后台发送数据格式 **(设置默认周起始日)**
     >
     > ```javascript
     > sendData = {
     >   spaceId: spaceId,
     >   name: name,
     >   domain: domain,
     >   weekStart: "sunday"
     > };
     > ```
     >
     > 后台接口返回：
     >
     > ​	新用户走创建流程，添加成功后，需要添加预置面板。
     >
     > ​	老用户走更新流程，更新前端空间信息。

  2. 空间成员邀请保存

     > 接口地址：LINK_SPACE_INVITE_USERS + spaceId + '/'+ Base64.encode(window.location.host);
     >
     > 后台发送数据格式
     >
     > 保存成功，则弹出邀请成功提示(3秒延迟显示)
     >
     > ```javascript
     > sendData = [email1, email2, email3, ...]
     > ```






---





### 空间邀请（space-invites）

**主要功能**

* 邀请新用户
	1. 输入密码注册(用户名只读)，并将用户信息及sid保存到本地
	2. 注册成功之后调用接受空间邀请接口
	3. 跳转到dashboard，默认选中该空间
* 邀请老用户
	1. 如果未登录则跳转到登录页面
	2. 如果已登录
		1. 如果当前登录用户邮箱与邀请邮箱一致，则跳转到dashboard页面，并选中该空间
		2. 否则，则退出当前用户，跳转到登录页面
* 链接失效处理
    1. 3s后跳转到/default路由


**表单校验**

1. 注册时密码为6-20位

### 空间成员管理(space-member)

**主要功能**

* 空间成员列表
* 空间成员邀请
    * 弹窗操作
    * 文本框中可以输入多个邮箱
* 删除
    * 删除前弹窗提示
* 重新发送
    * 发送成功后弹窗提示

### 空间设置(space-settings)

**主要功能**

* 空间信息更新
	* 更新成功后将重新刷新页面
* 删除空间
	* 删除前弹窗提示
	* 操作成功后
		1. 清除dashboard本地选中信息。
    	2. 判断空间列表是否为空，为空则跳转至 **创建空间** 流程。不为空则 **刷新** 进入列表中第一个空间。
* 退出空间
	* 退出前弹窗提示
	* 操作成功后同删除空间

**表单校验**

* 输入框失去焦点时校验、获得焦点时去掉错误提示
* 空间名称
	* 必填、最大长度30
	* 默认值同空间子域名（如果为空则设置）
* 空间子域名
	* 必填、最大长度30
	* 满足正则`[a-z0-9][a-z0-9_\-]{0,28}[a-z0-9]`
	* 失去焦点时校验唯一性


### 问题

**服务器端接口**

1. 空间保存时没有校验domain唯一性(数据中也没有唯一索引), 而且为空也可以保存成功。
2. 预制面板业务逻辑对前端应该是透明的。

